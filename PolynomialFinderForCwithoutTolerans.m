clear; % clear CommandWindow and workspace
 sayac=0;
 AGS=zeros(3,1);
 eps=1e-8;% for sedumi
 bigeps=eps;% for sedumi
 maxiter=400;% for sedumi
 degrees=1:20;
 timescale=1;
 tolerance=10^(-1);
 


 n=2;%the dimension of the state space
 hold on
         G = @(y)(0.1E1+y(1).^2).^3.*(0.1E1+y(2).^2).^3;
  F1=@(y)0.235493E-1.*((-0.141978E0)+(-0.200503E0).*y(1)+(-0.107963E1).*y( ...
  1).^2+0.708494E0.*y(1).^3+(-0.158114E1).*y(1).^4+0.150925E1.*y(1) ...
  .^5+(-0.64349E0).*y(1).^6+0.600252E0.*y(1).^7+0.399748E0.*y(2)+ ...
  0.102344E1.*y(1).*y(2)+0.165932E1.*y(1).^2.*y(2)+(-0.153208E0).*y( ...
  1).^3.*y(2)+(-0.936101E0).*y(1).^4.*y(2)+(-0.246363E1).*y(1).^5.* ...
  y(2)+(-0.219567E1).*y(1).^6.*y(2)+(-0.128698E1).*y(1).^7.*y(2)+( ...
  -0.294161E0).*y(2).^2+(-0.661836E0).*y(1).*y(2).^2+0.314692E1.*y( ...
  1).^2.*y(2).^2+0.897564E1.*y(1).^3.*y(2).^2+0.489356E1.*y(1).^4.* ...
  y(2).^2+0.924256E1.*y(1).^5.*y(2).^2+0.145248E1.*y(1).^6.*y(2).^2+ ...
  (-0.394918E0).*y(1).^7.*y(2).^2+0.1818E1.*y(2).^3+(-0.117665E1).* ...
  y(1).*y(2).^3+0.361493E0.*y(1).^2.*y(2).^3+(-0.486262E0).*y(1) ...
  .^3.*y(2).^3+0.545399E1.*y(1).^4.*y(2).^3+(-0.486262E0).*y(1).^5.* ...
  y(2).^3+0.691049E1.*y(1).^6.*y(2).^3+(-0.117665E1).*y(1).^7.*y(2) ...
  .^3+0.294161E0.*y(2).^4+0.279341E1.*y(1).*y(2).^4+0.262913E1.*y(1) ...
  .^2.*y(2).^4+0.40639E1.*y(1).^3.*y(2).^4+0.665853E1.*y(1).^4.*y(2) ...
  .^4+0.433082E1.*y(1).^5.*y(2).^4+0.432356E1.*y(1).^6.*y(2).^4+ ...
  0.306033E1.*y(1).^7.*y(2).^4+0.399748E0.*y(2).^5+(-0.128698E1).*y( ...
  1).*y(2).^5+0.379467E1.*y(1).^2.*y(2).^5+(-0.246363E1).*y(1).^3.* ...
  y(2).^5+0.333459E1.*y(1).^4.*y(2).^5+(-0.153208E0).*y(1).^5.*y(2) ...
  .^5+(-0.603263E-1).*y(1).^6.*y(2).^5+0.102344E1.*y(1).^7.*y(2).^5+ ...
  0.141978E0.*y(2).^6+0.199245E0.*y(1).*y(2).^6+(-0.755799E-1).*y(1) ...
  .^2.*y(2).^6+0.292624E1.*y(1).^3.*y(2).^6+(-0.729276E0).*y(1).^4.* ...
  y(2).^6+0.372699E1.*y(1).^5.*y(2).^6+(-0.511719E0).*y(1).^6.*y(2) ...
  .^6+0.1E1.*y(1).^7.*y(2).^6);

  F2=@(y)(-0.334347E-2)+0.941378E-2.*y(1)+(-0.692728E-2).*y(1).^2+ ...
  0.428124E-1.*y(1).^3+0.692728E-2.*y(1).^4+0.941378E-2.*y(1).^5+ ...
  0.334347E-2.*y(1).^6+(-0.47217E-2).*y(2)+0.241012E-1.*y(1).*y(2)+( ...
  -0.155857E-1).*y(1).^2.*y(2)+(-0.277091E-1).*y(1).^3.*y(2)+ ...
  0.657827E-1.*y(1).^4.*y(2)+(-0.303074E-1).*y(1).^5.*y(2)+ ...
  0.469208E-2.*y(1).^6.*y(2)+(-0.254245E-1).*y(2).^2+0.390758E-1.*y( ...
  1).*y(2).^2+0.741076E-1.*y(1).^2.*y(2).^2+0.85129E-2.*y(1).^3.*y( ...
  2).^2+0.619141E-1.*y(1).^4.*y(2).^2+0.893616E-1.*y(1).^5.*y(2).^2+ ...
  (-0.177985E-2).*y(1).^6.*y(2).^2+0.166845E-1.*y(2).^3+( ...
  -0.360792E-2).*y(1).*y(2).^3+0.21137E0.*y(1).^2.*y(2).^3+( ...
  -0.114511E-1).*y(1).^3.*y(2).^3+0.957018E-1.*y(1).^4.*y(2).^3+( ...
  -0.580166E-1).*y(1).^5.*y(2).^3+0.689107E-1.*y(1).^6.*y(2).^3+( ...
  -0.372347E-1).*y(2).^4+(-0.220445E-1).*y(1).*y(2).^4+0.11524E0.*y( ...
  1).^2.*y(2).^4+0.128437E0.*y(1).^3.*y(2).^4+0.156803E0.*y(1).^4.* ...
  y(2).^4+0.785272E-1.*y(1).^5.*y(2).^4+(-0.171739E-1).*y(1).^6.*y( ...
  2).^4+0.355417E-1.*y(2).^5+(-0.580166E-1).*y(1).*y(2).^5+ ...
  0.217656E0.*y(1).^2.*y(2).^5+(-0.114511E-1).*y(1).^3.*y(2).^5+ ...
  0.101988E0.*y(1).^4.*y(2).^5+(-0.360792E-2).*y(1).^5.*y(2).^5+ ...
  0.877679E-1.*y(1).^6.*y(2).^5+(-0.151537E-1).*y(2).^6+( ...
  -0.517065E-1).*y(1).*y(2).^6+0.342049E-1.*y(1).^2.*y(2).^6+ ...
  0.162737E0.*y(1).^3.*y(2).^6+0.101817E0.*y(1).^4.*y(2).^6+( ...
  -0.142064E-2).*y(1).^5.*y(2).^6+(-0.120506E-1).*y(1).^6.*y(2).^6+ ...
  0.141355E-1.*y(2).^7+(-0.303074E-1).*y(1).*y(2).^7+(-0.930002E-2) ...
  .*y(1).^2.*y(2).^7+(-0.277091E-1).*y(1).^3.*y(2).^7+0.720684E-1.* ...
  y(1).^4.*y(2).^7+0.241012E-1.*y(1).^5.*y(2).^7+0.235493E-1.*y(1) ...
  .^6.*y(2).^7+0.21684E-18.*y(2).^8+0.867362E-18.*y(1).*y(2).^8+ ...
  0.173472E-17.*y(1).^2.*y(2).^8+(-0.173472E-17).*y(1).^3.*y(2).^8+ ...
  0.173472E-17.*y(1).^4.*y(2).^8+0.867362E-18.*y(1).^5.*y(2).^8+( ...
  -0.21684E-18).*y(1).^6.*y(2).^8;

        for degree=degrees%this is actually the half of the degree
            degreeInt=1;
            x=sdpvar(n,1);
            y=sdpvar(n-1,1);
            degree*2;
            [rho,wrho] = polynomial(x,2*degree);
           
            f1 = F1(x);
            f2 = F2(x);
            g = G(x);
            div = jacobian( f1, x(1) )+...
                jacobian( f2, x(2) );
            fun = (g*rho*div+jacobian(rho,x)*[f1;f2]*g-rho*jacobian(g,x)*[f1;f2]);
            
            constr = [sos(fun),sos(rho-tolerance)];
           
            params = [wrho];
%             constr =
%             [sos(fun),sos(rho),sum(wrho)>=tolerance,wrho(1)>=tolerance];
%             params = [wrho];
%             constr = [sos(funRed),sos(rhoRed),sum(wrhoRed)>=toleranceRed];
%            params = [ wrhoRed];
            %options = sdpsettings('solver','sdpa');
            %options = sdpsettings('solver','sdpt3');
            options = sdpsettings('solver','sedumi','verbose',0,'sedumi.eps',eps,'sedumi.bigeps', ...
                bigeps,'sedumi.maxiter',maxiter);
            %options = sdpsettings('solver','mosek');
            [sol,~,~,~]=solvesos(constr,1,options,params);
            if sol.problem==0
                
                               
              
                break
            end
          
        end
 
display(double(wrho));


realparamB=double(wrho)
        x = sdpvar(1,1);y = sdpvar(1,1);
        vv = monolist([x; y],degree*2);
      
        Bpoly = sdisplay(round(realparamB,2)'*vv)
         B=eval(['@(x,y)' Bpoly{1}])
           








